# Queue CLI Kickoff Plan

## Goals
- Implement a `queue` binary that schedules commands for later execution using `--at` or `--in`.
- Ensure queued jobs run in the background and share current STDOUT/STDERR unless `--fg` is set.
- Provide clear errors and help text using `clap` derive attributes.

## CLI Design (clap derive)
- Define a single `queue` command with:
  - Mutually exclusive timing options: `--at <time>` and `--in <delay>`.
  - A required positional `command` string (raw shell command).
  - A `--fg` flag to run blocking in the foreground.
- Use `#[arg(value_parser = ...)]` to validate time/delay formats.
- Provide examples in doc comments so `clap` help output matches README usage.

## Parsing + Scheduling
- Implement parsers:
  - `parse_at_time`: accepts `7:00am`, `07:00`, `19:30`, defaulting to next future occurrence.
  - `parse_delay`: supports units (`s`, `m`, `h`, `d`) with optional whitespace and default minutes.
- Normalize into a `ScheduledAt` timestamp (UTC or local; decide once and document).
- For `--at`, if the time is earlier than now, roll forward to next day.

## Execution Model
- Spawn a child process using a shell (`/bin/sh -c`) to execute the command string.
- Background behavior:
  - If `--fg` is false, spawn an async task that waits until scheduled time then runs.
  - Ensure child inherits STDOUT/STDERR to match current terminal.
- Foreground behavior:
  - Block the main thread until scheduled time, then run and await exit status.
- Emit structured logs with `tracing` around schedule, wait, and execution steps.

## Storage + Lifecycle (if needed)
- Decide whether jobs are in-memory only or persisted (initially in-memory to match README scope).
- If persistence is needed, design a small JSON/SQLite store and background worker.
- Provide a clear migration path if persistence is added later.

## Tests
- Unit tests for `parse_at_time` and `parse_delay` with edge cases.
- Integration tests for clap argument validation (invalid combinations, missing args).
- Timing behavior tests using a mocked clock or short delays.

## Documentation
- Update `queue/README.md` with final CLI syntax and behavior notes.
- Add rustdoc comments for public types/functions following repo conventions.
