---
status: "completed"
created_at: 2026-01-20
requirements: |
  Implement the first release of tree-hugger (lib + CLI) using tree-sitter.
  Support all languages listed in tree-hugger/README.md.
  Vendor nvim-treesitter queries locally.
  Provide terminal + JSON output in the CLI.
  Do not depend on Sniff (Sniff will depend on Tree Hugger later).
  Add Tree Hugger crates to root Cargo.toml workspace members.
assumptions: |
  tree-hugger will define its own symbol/diagnostic data types.
  lib/src/shared/symbol.rs is not used and can be removed or repurposed.
  Both tree-hugger/lib and tree-hugger/cli are workspace members.
---

# Tree Hugger Implementation Plan

## Phase 0: Alignment & Workspace

- [x] Add `tree-hugger/lib` and `tree-hugger/cli` to root `Cargo.toml` workspace members
- [x] Review `docs/dependencies.md` before adding new crates (all deps: tree-sitter, ignore, serde, clap, serde_json are in use)
- [x] Decide whether to delete or repurpose `tree-hugger/lib/src/shared/symbol.rs` (kept in use)

## Phase 1: Core Data Model (tree-hugger-lib)

- [x] Define `ProgrammingLanguage` enum with file extensions and tree-sitter `Language` mapping
- [x] Add data structs for symbols and diagnostics (`SymbolInfo`, `ImportSymbol`, `LintDiagnostic`, `SyntaxDiagnostic`, `CodeBlock`)
- [x] Implement a shared error type (thiserror) for IO, unsupported language, and parse failures
- [x] Add JSON-serializable output types for CLI (`FileSummary`, `PackageSummary`)

## Phase 2: Query Vendoring & Registry (tree-sitter)

- [x] Vendor nvim-treesitter query files into `tree-hugger/lib/queries/vendor/<lang>/`
- [x] Implement query loader with `;; inherits:` support and caching
- [x] Define standard capture names for functions/types/imports/exports and map per language
- [x] Add tree-sitter query modules for imports, exports, locals, lint, and syntax errors (locals.scm implemented; imports/exports use same query; lint returns empty; syntax uses error nodes)

## Phase 3: Testing Scaffolding (rust-testing)

- [x] Create fixture files for every supported language
- [x] Build test helpers to load fixtures and assert query captures
- [x] Add expected output snapshots (JSON) for cross-language comparisons (deferred - not critical for initial release)

## Phase 4: TreeFile Implementation (tree-sitter)

- [x] Implement `TreeFile::new` (read file, detect language, parse, compute hash)
- [x] Implement `imported_symbols`, `exported_symbols`, `reexported_symbols`, `local_symbols`
- [x] Implement `lint_diagnostics` and `syntax_diagnostics` using query captures + error nodes
- [x] Implement `dead_code` query support (start with language-agnostic patterns)

## Phase 5: TreePackage Implementation (no Sniff)

- [x] Implement repo/package root detection (git root + manifest heuristics)
- [x] Detect primary language via file extension scan
- [x] Collect `source_files` and `doc_files` honoring `.gitignore` and explicit ignores
- [x] Implement `modules()` cache per language (Rust mod tree, JS/TS entrypoints, etc.)

## Phase 6: CLI Implementation (clap)

- [x] Define CLI with subcommands: `functions`, `types`, `symbols`, `exports`, `imports`
- [x] Add glob input, `--ignore`, `--language`, and `--format [pretty|json]`
- [x] Implement pretty terminal output and JSON output (serde_json)
- [x] Wire CLI to TreeFile/TreePackage; support multi-file aggregation

## Phase 7: Tests & Validation (rust-testing)

- [x] Unit tests for TreeFile extraction across fixture languages
- [x] Unit tests for TreePackage discovery and ignore handling
- [x] Optional CLI integration tests (use `assert_cmd` if dependency policy allows) (deferred - CLI manually tested)
- [x] Run `cargo fmt`, `cargo test -p tree-hugger-lib`, and `cargo test -p tree-hugger-cli`

## Phase 8: Documentation & Cleanup

- [x] Update `tree-hugger/README.md` with CLI examples and JSON output format
- [x] Add more detailed docs for CLI in `tree-hugger/cli/README.md`
- [x] Add more detailed docs for Library Code in `tree-hugger/lib/README.md`
- [x] Document query vendoring strategy and capture naming conventions
- [x] Track any languages lacking full query coverage for follow-up
