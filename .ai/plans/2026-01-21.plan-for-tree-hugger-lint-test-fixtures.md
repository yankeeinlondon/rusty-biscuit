---
status: "done"
started_at: "14:53:00"
finished_at: "15:00:00"
duration: "7 minutes"
tts_gender: male
requirements: |
  Build world-class test fixtures for tree-hugger lint diagnostics with comprehensive
  positive and negative tests covering straightforward examples and edge cases.

  User Preferences (confirmed):
  - Fixture organization: Per-rule fixtures (separate file per rule per language)
  - Edge case coverage: Exhaustive (multi-line, nested, unicode, empty, boundary)
  - Future rules: Include fixtures for planned rules even if queries aren't ready

  Fixture Requirements:
  - All 16 languages must have dedicated lint fixtures
  - Each lint rule must have positive tests (code that triggers the rule)
  - Each lint rule must have negative tests (code that should NOT trigger)
  - Per-rule file organization: lint_{rule_id}_{lang}.{ext}
  - Edge cases: multi-line constructs, nested scopes, unicode, empty files,
    comments in strings, boundary conditions
  - Context verification: ensure SourceContext line_text and underline positions are accurate
  - Include fixtures for future rules: unused-import, dead-code, undefined-symbol

  Testing Requirements:
  - Test each rule produces correct severity level
  - Test each rule produces correct message
  - Test source context accuracy (line extraction, column position, underline length)
  - Test that negative cases produce no diagnostics
  - Test edge cases don't cause false positives or false negatives
  - Regression tests for any discovered bugs

required_skills:
  - rust
  - tree-sitter
  - rust-testing
important_skills:
  tree-sitter: "Query syntax and capture conventions"
  rust-testing: "Comprehensive test organization and assertion patterns"
subagents:
  skill-picker: "Identify skills"
  Plan: "Create phased plan for fixture creation"
  general-purpose: "Reviews and finalization"
  feature-tester-rust: "Test implementation"
monorepo_modules_impacted:
  - tree-hugger/lib
lessons_learned_count: 8
---
# Planning Process

- [x] Prep Started [14:53]
    - [x] Identified Skills [14:54] - rust, rust-testing, tree-sitter, clap
    - [x] Identified Subagents [14:54] - skill-picker, Plan, general-purpose, feature-tester-rust
- [x] Prep complete with 35% context available [14:54]
- [x] Clarify (orchestrator) started [14:55]
    - [x] User asked clarifying questions (human in the loop) [14:55]
    - Fixture org: Per-rule (separate file per rule per language)
    - Edge cases: Exhaustive coverage
    - Future rules: Yes, include planned rules
    - [x] Requirements have been updated based on user responses [14:55]
- [x] Planning Subagent [agent: **Plan**] started [14:55]
    - [x] subagent skills used: rust, rust-testing, tree-sitter, clap
    - [x] Planning completed [14:57]
- [x] All Pre-review Steps are complete
    - 30% of context window is still available
- [x] Review Started [14:57]
    - [x] Completeness Review [agent: **general-purpose**]
        - [x] subagent skills used: rust, tree-sitter, rust-testing
        - Findings: 14 recommendations (2 critical, 6 high); phase-level skill specs needed; split by RULE not LANGUAGE
    - [x] Concurrency Review [agent: **general-purpose**]
        - [x] subagent skills used: rust, rust-testing
        - Findings: Plan can leverage existing cargo test parallelization; fixture creation is race-free
    - [x] Details/Correctness Review [agent: **general-purpose**]
        - [x] subagent skills used: rust, tree-sitter
        - Findings: Code snippets verified correct; SourceContext fields accurate; 16/16 lint.scm files verified
- [x] Reviews Completed [14:58]
    - 30% of context window is still available
- [x] Plan Finalization [agent: **general-purpose**] started [14:58]
    - [x] subagent skills used: rust, rust-testing, tree-sitter, clap
- [x] Plan finalized [14:59]
    - 30% of context window is still available
- [x] Final Steps
    - [x] Lessons learned collected from all subagents (8 items)
    - No package changes required - test fixtures use existing dependencies
- [x] Summarized plan to user via STDOUT
    - Project File: `.ai/plans/2026-01-21.plan-for-tree-hugger-lint-test-fixtures.md`
    - Started: 14:53:00
    - Completed: 15:00:00
    - Duration: 7 minutes


## Plan

### Baseline Context

**Already Implemented (NOT part of this plan):**

- All 16 `lint.scm` query files exist with rules: `debug-print`, `empty-block`, `unwrap-call`, `expect-call`
- `SourceContext` struct in `tree-hugger/lib/src/shared/symbol.rs`
- `LintDiagnostic` struct with `context: Option<SourceContext>` field
- `lint_diagnostics()` method on `TreeFile` fully implemented
- `severity_for_rule()` and `format_rule_message()` helper functions
- CLI `lint` subcommand with `--json` and `--plain` output

**Note:** The `todo-comment` rule has been REMOVED from scope per user request.

**Estimated Duration: 6-8 hours**

---

### Phase 1: Test Infrastructure Setup

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing |
| **Suggested Skills** | None |
| **Complexity** | Medium |
| **Dependencies** | None |
| **Parallelizable** | Yes (no dependencies) |

**Objective:** Create reusable test helpers, assertion macros, and fixture directory structure.

**Deliverables:**

- `lint_helpers.rs` module with `lint_fixture_path()`, `assert_lint_contains_rule()`, `assert_lint_excludes_rule()`, `assert_lint_rule_count()`
- Fixture directory structure: `fixtures/lint/{rule}/{lang}_{variant}.{ext}`

**Acceptance Criteria:**

- [ ] Helper functions compile and handle all 16 languages
- [ ] Assertion functions provide informative error messages
- [ ] Fixture directory structure created

---

### Phase 2: Core Rule Fixtures - debug-print

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing, tree-sitter |
| **Complexity** | Medium |
| **Dependencies** | Phase 1 |
| **Parallelizable** | Yes (parallel with Phases 3-5) |

**Objective:** Create fixtures for `debug-print` rule (JS console.*, Python print, Go fmt.Print*, etc.).

**Acceptance Criteria:**

- [ ] All applicable languages have debug-print fixtures
- [ ] Rust confirms NO debug-print diagnostics (by design)

---

### Phase 3: Core Rule Fixtures - empty-block

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing, tree-sitter |
| **Complexity** | Medium |
| **Dependencies** | Phase 1 |
| **Parallelizable** | Yes (parallel with Phases 2, 4-5) |

**Objective:** Create fixtures for `empty-block` rule (JS/TS `{}`, Python `pass`, etc.).

**Acceptance Criteria:**

- [ ] JavaScript/TypeScript empty block detection works
- [ ] Python `pass` statement detection works

---

### Phase 4: Core Rule Fixtures - Rust-Specific (unwrap/expect)

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing, tree-sitter |
| **Complexity** | Low |
| **Dependencies** | Phase 1 |
| **Parallelizable** | Yes (parallel with Phases 2-3, 5) |

**Objective:** Create fixtures for Rust-specific `unwrap-call` and `expect-call` rules.

**Acceptance Criteria:**

- [ ] `unwrap-call` fires on Option and Result unwrap
- [ ] `expect-call` fires on expect calls
- [ ] Chained unwraps report multiple diagnostics

---

### Phase 5: Edge Case Fixtures

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing, tree-sitter |
| **Complexity** | High |
| **Dependencies** | Phase 1 |
| **Parallelizable** | Yes (parallel with Phases 2-4) |

**Objective:** Create edge case fixtures for boundary conditions and false positive prevention.

**Deliverables:**

- `unicode_identifiers.rs` - Unicode in variable names
- `multiline_print.py` - Multi-line print statements
- `nested_blocks_deep.go` - Deeply nested empty blocks
- `chained_unwrap.rs` - Multiple chained .unwrap() calls
- `empty_file.rs` - Zero-byte file
- `whitespace_only.py` - Whitespace-only file

**Acceptance Criteria:**

- [ ] Empty files return empty diagnostics (no panic)
- [ ] Unicode doesn't break column calculations
- [ ] Deeply nested constructs are detected correctly
- [ ] Chained method calls report multiple diagnostics

---

### Phase 6: SourceContext Verification Tests

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing |
| **Complexity** | Medium |
| **Dependencies** | Phase 1 |
| **Parallelizable** | Yes (parallel with Phases 2-5) |

**Objective:** Verify `SourceContext` field accuracy (line_text, underline_column, underline_length).

**Acceptance Criteria:**

- [ ] `line_text` contains exact source line with indentation
- [ ] `underline_column` is 0-based and accounts for whitespace
- [ ] `underline_length` matches captured node span
- [ ] Multi-line diagnostics cap underline at first line end

---

### Phase 7: Future Rule Fixtures (Ignored)

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing |
| **Complexity** | Low |
| **Dependencies** | Phase 1 only |
| **Parallelizable** | Yes |

**Objective:** Create placeholder fixtures for future rules (`unused-import`, `dead-code`, `undefined-symbol`) with `#[ignore]` tests.

**Acceptance Criteria:**

- [ ] Fixtures exist in `fixtures/lint/future-rules/`
- [ ] Tests compile but are marked `#[ignore]`

---

### Phase 8: CLI Integration Tests

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, rust-testing, clap |
| **Complexity** | Medium |
| **Dependencies** | Phases 2-5 (need fixtures) |
| **Parallelizable** | No (final validation) |

**Objective:** Add CLI tests for `hug lint` subcommand.

**Acceptance Criteria:**

- [ ] `hug lint --help` shows documentation
- [ ] JSON output includes `rule`, `severity`, `context` fields
- [ ] Clean files show "no lint diagnostics" message
- [ ] Glob patterns work for multiple files

---

### Phase 9: Documentation and Coverage Report

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Complexity** | Low |
| **Dependencies** | Phases 1-8 |
| **Parallelizable** | No (final phase) |

**Objective:** Update README with coverage matrix and verify all tests pass.

**Acceptance Criteria:**

- [ ] README includes lint rule coverage matrix
- [ ] All tests pass: `cargo test -p tree-hugger-lib && cargo test -p tree-hugger-cli`

---

### Phase Dependencies

```
Phase 1 (Infrastructure) ─────┬──► Phases 2-6 (ALL PARALLEL) ──► Phase 8 (CLI Tests)
                              │                                        │
                              └──► Phase 7 (Future Rules)              ▼
                                                                  Phase 9 (Docs)
```

**Summary Statistics:**

- Total Phases: 9
- Parallelizable: 7 (Phases 2-7 all parallel after Phase 1)
- Estimated Duration: 5-7 hours
- Languages: 16
- Rules: 4 current (debug-print, empty-block, unwrap-call, expect-call) + 3 future


## Lessons Learned

> Capture discoveries about skills or memory resources (CLAUDE.md, README.md, etc.) that were inaccurate, incomplete, or missing.

- [CODEBASE: lint infrastructure]: All core lint infrastructure is complete - phases 1-5 of prior lint-diagnostics plan fully implemented. Always verify completion status before planning.
- [ARCHITECTURE: fixture organization]: Organizing fixtures by RULE rather than LANGUAGE enables better parallel development and clearer coverage mapping.
- [DESIGN_PATTERN: fixture naming]: Use `{lang}_{variant}.{ext}` naming (e.g., `rust_positive_simple.rs`) to enable parametric iteration.
- [CODEBASE: lint queries]: Each language's lint.scm uses language-specific comment/print patterns - fixtures must match exact AST node types.
- [CODEBASE: Perl lint]: Perl has placeholder lint.scm with no actual rules - test fixtures should document this limitation.
- [SKILL: rust-testing]: The `assert_cmd` crate with `predicates` provides excellent CLI testing ergonomics.
- [PLAN_PATTERN: phase structure]: Every phase requires explicit Subagent + Required/Suggested Skills + Complexity + Acceptance Criteria.
- [API_CORRECTNESS: capture naming]: The @diagnostic.{rule_id} convention is correctly parsed via `strip_prefix("diagnostic.")`.


## Package Changes in Execution

> No package changes required - test fixtures use existing dependencies (tempfile, tree-hugger-lib, assert_cmd).

