---
status: "executed"
started_at: 16:51:31
finished_at: 17:01:27
duration: 10 minutes
execution_started: 17:05:00
execution_finished: 17:22:00
execution_duration: 17 minutes
tts_gender: male
requirements:
  Remove all TTS functionality from `biscuit` package and move to `biscuit-speaks`. Update ALL consumers (so-you-say, research/cli, research/lib) to import from the new package.
required_skills:
  - rust
  - thiserror
important_skills:
  cargo-workspace: "If available, helps with workspace structure"
  anyhow: "Repository uses anyhow for application-level errors"
subagents:
  module-structure-agent: "TTS extraction and biscuit-speaks setup"
  import-migration-agent: "Update imports across affected packages"
monorepo_modules_impacted:
  - biscuit (remove TTS module)
  - biscuit-speaks (new TTS home)
  - so-you-say (update imports)
  - research/cli (update imports)
  - research/lib (update imports)
completeness_changes: []
concurrency_changes: []
detail_changes: []
lessons_learned_count: 7
---
# Planning Process

- [x] Prep Started [16:51:31]
    - [x] Identified Skills [16:52:36]
    - [x] Identified Subagents [16:52:36]
- [x] Prep complete with 35% context available [16:52:36]
- [x] Clarify (orchestrator direct) [16:53:51]
    - [x] User asked clarifying questions (human in the loop) [16:53:51]
    - [x] Confirmed: Update ALL TTS consumers (so-you-say, research/cli, research/lib)
    - [x] Requirements updated [16:53:51]
- [x] Planning Subagent [agent: **Plan**] started [16:53:51]
    - [x] subagent skills used: rust, thiserror
    - [x] Planning completed [16:56:08]
- [x] Module Assessment (included in Plan phase - monorepo analysis done)
- [x] All Pre-review Steps are complete
    - 35% of context window still available
- [x] Review Started [16:56:54]
   - [x] Completeness Review [agent: **general-purpose (haiku)**]
       - [x] subagent skills used: rust, thiserror
   - [x] Concurrency Review [agent: **general-purpose (haiku)**]
       - [x] subagent skills used: rust
   - [x] Details/Knowledge Based Review [agent: **general-purpose (haiku)**]
       - [x] subagent skills used: rust, thiserror
- [x] Reviews Completed [16:59:18]
    - 35% of context window still available
- [x] Plan Finalization [agent: **general-purpose**] started [16:59:18]
    - [x] subagent skills used: rust, thiserror
- [x] Plan finalized [17:01:27]
    - 35% of context window still available
- Final Steps
    - [x] Lessons learned collected from all subagents
    - [x] No new packages need research (tts, thiserror, tracing already known)
- [x] Summarized plan to user via STDOUT
    - Project File: `.ai/plans/2026-01-15.plan-for-tts-extraction-to-biscuit-speaks.md`
    - Started: 16:51:31
    - Completed: 17:01:27
    - Duration: 10 minutes



## Plan

**Naming Convention:**
- **Package name (Cargo.toml):** `biscuit-speaks` (hyphenated)
- **Crate name (use statements):** `biscuit_speaks` (underscored)

### Phase 1: Set Up biscuit-speaks Package

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | None |
| **Parallelizable** | No (foundational) |

**Objective:** Configure `biscuit-speaks/Cargo.toml` with required dependencies and create lib.rs placeholder.

**Deliverables:**
- Updated `biscuit-speaks/Cargo.toml` with:
  - `edition = "2021"` and `license = "AGPL-3.0-only"` (workspace standards)
  - `[lib] name = "biscuit_speaks"`
  - Dependencies: `tts = "0.26.3"`, `thiserror = "2.0"`, `tracing = "0.1"`
- Updated `biscuit-speaks/justfile` to reference correct package name
- Create `biscuit-speaks/src/lib.rs` placeholder

**Acceptance Criteria:**
- [ ] `biscuit-speaks/Cargo.toml` contains all required dependencies and fields
- [ ] `cargo check -p biscuit-speaks` succeeds
- [ ] `biscuit-speaks/justfile` commands reference `biscuit-speaks` (not `biscuit-hash`)

---

### Phase 2: Migrate TTS Module to biscuit-speaks

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, thiserror |
| **Suggested Skills** | - |
| **Complexity** | Medium |
| **Dependencies** | Phase 1 |
| **Parallelizable** | No |

**Objective:** Move TTS implementation from `biscuit/src/tts.rs` to `biscuit-speaks/src/lib.rs`.

**Deliverables:**
- Copy `biscuit/src/tts.rs` content to `biscuit-speaks/src/lib.rs`
- Update 22 doc comment examples: change `shared::tts::` to `biscuit_speaks::`
- Create re-export stub in `biscuit/src/tts.rs`: `pub use biscuit_speaks::*;`
- Add `biscuit-speaks` dependency to `biscuit/Cargo.toml` (temporary, for transition)

**Acceptance Criteria:**
- [ ] All types/functions/tests from `tts.rs` present in `biscuit-speaks/src/lib.rs`
- [ ] Doc examples use `biscuit_speaks::` import paths
- [ ] Re-export stub allows existing consumers to work unchanged
- [ ] `cargo check -p biscuit-speaks` succeeds
- [ ] `cargo test -p biscuit-speaks` passes all tests

---

### Phase 3: Update so-you-say Consumer

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 2 |
| **Parallelizable** | Yes (with Phase 4, Phase 5) |

**Objective:** Update `so-you-say` to depend on `biscuit-speaks`.

**Deliverables:**
- Add `biscuit-speaks = { path = "../biscuit-speaks" }` to `so-you-say/Cargo.toml`
- Update `so-you-say/src/main.rs`:
  - Line 2: `use shared::tts::{...}` to `use biscuit_speaks::{...}`
  - Line 311: `shared::tts::speak_when_able` to `biscuit_speaks::speak_when_able`

**Acceptance Criteria:**
- [ ] `so-you-say/Cargo.toml` includes `biscuit-speaks` dependency
- [ ] Imports changed to `use biscuit_speaks::{Gender, SystemVoiceInfo, VoiceConfig, VoiceSelector, available_system_voices};`
- [ ] `cargo check -p so-you-say` succeeds

---

### Phase 4: Update research/cli Consumer

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 2 |
| **Parallelizable** | Yes (with Phase 3, Phase 5) |

**Objective:** Update `research-cli` to depend on `biscuit-speaks`.

**Deliverables:**
- Add `biscuit-speaks = { path = "../../biscuit-speaks" }` to `research/cli/Cargo.toml`
- Update `research/cli/src/main.rs`:
  - Line 265: `use shared::tts::{VoiceConfig, speak_when_able}` to `use biscuit_speaks::{...}`
  - Line 348: Same pattern

**Acceptance Criteria:**
- [ ] `research/cli/Cargo.toml` includes `biscuit-speaks` dependency
- [ ] `cargo check -p research-cli` succeeds

---

### Phase 5: Update research/lib Consumer

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 2 |
| **Parallelizable** | Yes (with Phase 3, Phase 4) |

**Objective:** Update `research-lib` dev binary to depend on `biscuit-speaks`.

**Deliverables:**
- Add `biscuit-speaks = { path = "../../biscuit-speaks" }` to `research/lib/Cargo.toml`
- Update `research/lib/src/main.rs`:
  - Line 24: Change `shared::tts::speak_when_able` to `biscuit_speaks::speak_when_able`

**Acceptance Criteria:**
- [ ] `research/lib/Cargo.toml` includes `biscuit-speaks` dependency
- [ ] `cargo check -p research-lib` succeeds

---

### Phase 6: Remove TTS from biscuit Package

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 3, Phase 4, Phase 5 |
| **Parallelizable** | No |

**Objective:** Remove TTS module and dependency from `biscuit` (shared) package.

**Deliverables:**
- Delete `biscuit/src/tts.rs` (the re-export stub)
- Update `biscuit/src/lib.rs`:
  - Remove line 38: `pub mod tts;`
  - Update line 19: Remove TTS from module documentation
- Update `biscuit/Cargo.toml`:
  - Remove `tts = "0.26.3"` dependency
  - Remove temporary `biscuit-speaks` dependency

**Acceptance Criteria:**
- [ ] `biscuit/src/tts.rs` deleted
- [ ] `pub mod tts;` removed from `biscuit/src/lib.rs`
- [ ] `tts = "0.26.3"` removed from `biscuit/Cargo.toml`
- [ ] `cargo check -p shared` succeeds

---

### Phase 7: Update Documentation

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | - |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 6 |
| **Parallelizable** | Yes (with Phase 8) |

**Objective:** Update README files to reflect new architecture.

**Deliverables:**
- Update `biscuit-speaks/README.md`: Add usage examples with correct import paths
- Update `biscuit/README.md`:
  - Fix line 177: incorrect `shared::tts::announce` reference
  - Remove TTS section, add note about migration to `biscuit-speaks`

**Acceptance Criteria:**
- [ ] `biscuit-speaks/README.md` contains working usage examples
- [ ] `biscuit/README.md` no longer references TTS module

---

### Phase 8: Final Validation

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust |
| **Suggested Skills** | nextest (faster test execution) |
| **Complexity** | Low |
| **Dependencies** | Phase 6 |
| **Parallelizable** | Yes (with Phase 7) |

**Objective:** Validate complete migration with workspace-wide tests.

**Deliverables:**
- Test report for `biscuit-speaks` package
- Clippy lint check
- Workspace build verification
- Smoke test TTS functionality

**Acceptance Criteria:**
- [ ] `cargo test -p biscuit-speaks` passes all tests
- [ ] `cargo test -p so-you-say` passes all tests
- [ ] `cargo clippy --workspace` produces no new warnings
- [ ] `cargo build --workspace` succeeds
- [ ] `cargo run -p so-you-say -- --list-voices` works

---

## Dependency Graph

```
Phase 1 ──► Phase 2 ──┬──► Phase 3 ──┐
                      ├──► Phase 4 ──┼──► Phase 6 ──┬──► Phase 7
                      └──► Phase 5 ──┘              └──► Phase 8
```

- Phases 3, 4, 5 can run in parallel after Phase 2
- Phases 7 and 8 can run in parallel after Phase 6


## Lessons Learned

> Capture discoveries about skills or memory resources (CLAUDE.md, README.md, etc.) that were inaccurate, incomplete, or missing.

- [FILE: biscuit-speaks/justfile]: References `biscuit-hash` instead of `biscuit-speaks` - copied from biscuit-hash without updating
- [NAMING: biscuit vs shared]: Directory is `biscuit/` but package name is `shared` - must use package name in cargo commands
- [FILE: biscuit/README.md]: Line 177 references `shared::tts::announce` which is not a real export (should be `speak_when_able`)
- [PACKAGE: biscuit-speaks/Cargo.toml]: Missing edition and license fields - needs workspace standard fields
- [CRATE: biscuit-speaks]: Package name "biscuit-speaks" (hyphens) != crate name "biscuit_speaks" (underscores) in use statements
- [FILE: biscuit/src/tts.rs]: Contains 22 documentation examples using `shared::tts::` that require updating
- [REPO: dockhand]: All crates use invalid `edition = "2024"` - should be "2021" (tracked separately, not fixed in this plan)


## Package Changes in Execution

> Dependencies to be added, updated, or removed during implementation. Research for ADD actions produces skill files.

- [ADD(biscuit-speaks)]: tts in cargo - provides cross-platform text-to-speech engine
- [ADD(biscuit-speaks)]: thiserror in cargo - derive macro for error types
- [ADD(biscuit-speaks)]: tracing in cargo - instrumentation for function calls
- [REMOVE(shared)]: tts dependency - migrated to biscuit-speaks
- [ADD(so-you-say)]: biscuit-speaks - direct TTS import
- [ADD(research-cli)]: biscuit-speaks - direct TTS import
- [ADD(research-lib)]: biscuit-speaks - direct TTS import
