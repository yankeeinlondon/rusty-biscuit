# Research Show Command Implementation Plan

**Created:** 2026-01-04
**Status:** Reviewed - Ready for Implementation

## Review Summary

**Reviews Completed:** 2026-01-04

**Reviewers:**
- Rust Developer: Approve with Changes

**Key Changes from Review:**
1. Use `RESEARCH_DIR` env var with fallback to `~/.research/` (consistent with existing code)
2. Change glob pattern from `**/deep_dive.md` to `library/*/deep_dive.md` (match actual structure)
3. Use `dirs = "5.0"` to match research-lib version
4. Add helpful error message suggesting `research list` when topic not found

**Resolved Concerns:**
- Directory resolution now matches existing `research_lib::list()` pattern
- Glob pattern matches actual research directory structure

---

## Executive Summary

Add a `show` subcommand to the Research CLI that opens the `deep_dive.md` document for a specified topic using the system's default application. Topics are discovered by globbing for `{RESEARCH_DIR}/library/*/deep_dive.md`.

## Requirements

### Functional Requirements

| ID | Requirement | Priority | Owner |
|----|-------------|----------|-------|
| FR-1 | Add `show <topic>` subcommand to research CLI | High | Rust Developer |
| FR-2 | Discover topics by globbing for `library/*/deep_dive.md` | High | Rust Developer |
| FR-3 | Open deep_dive.md with system default application | High | Rust Developer |
| FR-4 | Error gracefully if topic not found | Medium | Rust Developer |

### Non-Functional Requirements

| ID | Requirement | Target | Owner |
|----|-------------|--------|-------|
| NFR-1 | Topic discovery should be fast | <100ms | Rust Developer |
| NFR-2 | Cross-platform support (macOS, Linux, Windows) | All platforms | Rust Developer |

## Architecture Overview

### Component Changes

The change is minimal - only the CLI needs modification:

```
research/cli/src/main.rs
├── Add Show variant to Commands enum
├── Add show_topic() handler function
└── Implement topic discovery using glob
```

### Data Flow

```
User: research show clap
         │
         ▼
   Parse CLI args (clap)
         │
         ▼
   Resolve RESEARCH_DIR or ~/.research/
         │
         ▼
   Glob {base}/library/*/deep_dive.md
         │
         ▼
   Find matching topic directory
         │
         ▼
   open::that(deep_dive.md path)
         │
         ▼
   System opens file in default app
```

## Phases

### Phase 1: Add Show Command

**Principal Owner:** Rust Developer

**Goal:** Implement the show command with topic discovery and file opening

**Dependencies:** None

**Blast Radius:** `cargo build -p research-cli && cargo run -p research-cli -- show --help`

**Files to modify:**
- `research/cli/Cargo.toml` - Add `open`, `glob`, and `dirs` dependencies
- `research/cli/src/main.rs` - Add Show command variant and handler

**Technical Details:**

1. Add dependencies to `research/cli/Cargo.toml`:
```toml
dirs = "5.0"
glob = "0.3"
open = "5"
```

2. Add Show variant to Commands enum:
```rust
/// Show a research topic's deep dive document
Show {
    /// The topic to show (directory name under ~/.research/library/)
    #[arg(value_name = "TOPIC")]
    topic: String,
},
```

3. Add show_topic handler:
```rust
fn show_topic(topic: &str) -> Result<(), Box<dyn std::error::Error>> {
    // Match the pattern used in research_lib (respects RESEARCH_DIR env var)
    let base = std::env::var("RESEARCH_DIR")
        .map(PathBuf::from)
        .unwrap_or_else(|_| {
            dirs::home_dir().unwrap_or_else(|| PathBuf::from("."))
        });

    let library_dir = base.join(".research").join("library");

    // Glob only immediate children, matching discover_topics() behavior
    let pattern = format!("{}/*/deep_dive.md", library_dir.display());

    for entry in glob::glob(&pattern)? {
        let path = entry?;
        // Get parent (should be the topic directory)
        if let Some(parent) = path.parent() {
            if let Some(name) = parent.file_name() {
                if name.to_string_lossy() == topic {
                    open::that(&path)?;
                    return Ok(());
                }
            }
        }
    }

    Err(format!(
        "Topic '{}' not found. Run 'research list' to see available topics.",
        topic
    ).into())
}
```

4. Add match arm in main():
```rust
Commands::Show { topic } => {
    if let Err(e) = show_topic(&topic) {
        eprintln!("Error: {}", e);
        std::process::exit(1);
    }
}
```

**Acceptance Criteria:**
- [ ] `grep 'dirs = "5.0"' research/cli/Cargo.toml` succeeds
- [ ] `grep 'glob = "0.3"' research/cli/Cargo.toml` succeeds
- [ ] `grep 'open = "5"' research/cli/Cargo.toml` succeeds
- [ ] `grep "Show {" research/cli/src/main.rs` succeeds
- [ ] `grep "fn show_topic" research/cli/src/main.rs` succeeds
- [ ] `grep 'library/\*/deep_dive.md' research/cli/src/main.rs` succeeds
- [ ] `cargo build -p research-cli` succeeds
- [ ] `cargo run -p research-cli -- show --help` shows help text
- [ ] `cargo run -p research-cli -- show clap` opens the clap deep dive (manual test)
- [ ] `cargo run -p research-cli -- show nonexistent` shows helpful error with list suggestion

---

## Cross-Cutting Concerns

### Testing Strategy

- Manual testing: Verify `research show <topic>` opens the correct file
- Error case: Verify helpful message when topic doesn't exist
- No automated tests needed for this simple feature (opens external application)

### Platform Considerations

- `open` crate handles cross-platform differences:
  - macOS: Uses `open` command
  - Linux: Uses `xdg-open`
  - Windows: Uses `start`

### Future Enhancements (Out of Scope for v1)

- Tab completion for topic names
- `--list` flag to show available topics (already exists as `research list`)
- Support for opening other documents (skill/SKILL.md, brief.md)

## Parallelization Opportunities

Not applicable - single phase implementation.

## Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|------------|
| `open` crate fails on some systems | Low | Well-maintained crate, graceful error handling |
| Topic naming conflicts | Low | First match wins, matches existing `list` behavior |

## Open Questions

None - requirements are clear and simple.

## Dependencies to Add

### research/cli/Cargo.toml

```toml
dirs = "5.0"
glob = "0.3"
open = "5"
```
