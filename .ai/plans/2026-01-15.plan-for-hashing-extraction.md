---
status: "done"
started_at: 15:56:00
finished_at: 16:05:00
duration: ~9 minutes
tts_gender: male
requirements:
  Extract the hashing module from the biscuit (shared) package and migrate xx_hash to use biscuit-hash.
  - Remove shared::hashing::xx_hash module entirely (no re-export facade)
  - Migrate only xx_hash in this phase (keep blake3 and argon2id in shared)
  - Update internal usages in markdown/toc and markdown/delta to use biscuit_hash::
  - Remove HashVariant from shared::hashing (use biscuit_hash::HashVariant instead)
  - Keep shared::hashing module for blake3 and argon2id only
required_skills: [rust, monorepos]
important_skills:
  thiserror: "Error handling in argon2id"
  nextest: "Test validation"
subagents:
  Plan: "Create phased implementation plan"
  Explore: "Module assessment for monorepo impact"
  general-purpose: "Reviews and finalization"
  feature-tester-rust: "Test validation"
monorepo_modules_impacted:
  - biscuit/src/hashing/ (remove xx_hash.rs, update mod.rs)
  - biscuit/src/markdown/toc/ (update imports)
  - biscuit/src/markdown/delta/ (update imports)
  - biscuit/src/mermaid/ (update imports)
completeness_changes: []
concurrency_changes: []
detail_changes: []
lessons_learned_count: 0
---
# Planning Process

- [x] Prep Started [15:56:00]
    - [x] Identified Skills [15:57]: rust, monorepos, thiserror, nextest
    - [x] Identified Subagents [15:57]: Plan, Explore, general-purpose, feature-tester-rust
- [x] Prep complete [15:58]
- [x] Clarify with user (human in the loop) [15:59]
    - [x] Requirements updated based on user responses [15:59]
        - API Strategy: Remove shared::hashing::xx_hash entirely (no facade)
        - Migration Scope: xx_hash only (keep blake3/argon2id in shared)
- [x] Planning Subagent [agent: Plan] started [16:00]
    - [x] subagent skills used: rust, monorepos
    - [x] Planning completed [16:01]
- [x] Module Assessment Subagent [agent: Explore] started [16:00]
    - [x] subagent skills used: rust, monorepos
    - [x] Module Assessment completed [16:01]
    - Impact: 5 files to modify, 1 file to delete
    - Additional discovery: mermaid/mod.rs also uses xx_hash
- [x] All Pre-review Steps are complete [16:01]
- [x] Review Started [16:02]
   - [x] Completeness Review
       - [x] subagent skills used: rust, monorepos
       - Issues: mermaid/mod.rs missing from file list, Phase 3 re-export removal incomplete
   - [x] Concurrency Review
       - [x] subagent skills used: rust, monorepos
       - Opportunities: Parallelize Phase 2 file updates, split Phase 5 validation
   - [x] Details/Knowledge Based Review
       - [x] subagent skills used: rust
       - Issues: Feature flag consideration, dependency cleanup incomplete
- [x] Reviews Completed [16:03]
- [x] Plan Finalization [agent: general-purpose] started [16:04]
    - [x] subagent skills used: rust, monorepos, nextest
- [x] Plan finalized [16:05]
- Final Steps
    - [x] Lessons learned collected from all subagents (3 items)
    - [x] No new packages to research (using existing biscuit-hash)
- [x] Summarized plan to user via STDOUT [16:05]
    - Project File: .ai/plans/2026-01-15.plan-for-hashing-extraction.md
    - Started: 15:56:00
    - Completed: 16:05:00
    - Duration: ~9 minutes

## Plan

### Phase 1: Add biscuit-hash Dependency to shared

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, monorepos |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | None |
| **Parallelizable** | No (foundational) |

**Objective:** Add `biscuit-hash` as a workspace dependency to the `shared` package's `Cargo.toml`.

**Deliverables:**
- Updated `biscuit/Cargo.toml` with biscuit-hash dependency (default features include `xx_hash`)

**Acceptance Criteria:**
- [ ] `biscuit-hash = { path = "../biscuit-hash" }` added to `biscuit/Cargo.toml`
- [ ] `cargo check -p shared` succeeds

---

### Phase 2: Update Internal Usages

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Medium |
| **Dependencies** | Phase 1 |
| **Parallelizable** | Yes (file updates are independent) |

**Objective:** Update all internal usages to import xxHash functions from `biscuit_hash` instead of `crate::hashing`.

**Deliverables:**
- Updated `biscuit/src/mermaid/mod.rs` (lines 160-164)
- Updated `biscuit/src/markdown/toc/mod.rs` (line 25)
- Updated `biscuit/src/markdown/toc/types.rs` (lines 82, 136, 215, 280)
- Updated `biscuit/src/markdown/delta/mod.rs` (line 268)

**Acceptance Criteria:**
- [ ] All 4 files updated to import from `biscuit_hash::` instead of `crate::hashing::`
- [ ] `cargo check -p shared` succeeds

---

### Phase 3: Remove xx_hash Module from shared

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Medium |
| **Dependencies** | Phase 2 |
| **Parallelizable** | No |

**Objective:** Remove the `xx_hash.rs` module and update `hashing/mod.rs` while **preserving** blake3 and argon2id functionality.

**Deliverables:**
- Deleted `biscuit/src/hashing/xx_hash.rs`
- Updated `biscuit/src/hashing/mod.rs` (remove xx_hash module, HashVariant, keep blake3/argon2id)
- Updated `biscuit/Cargo.toml` (remove xxhash-rust dependency)

**Acceptance Criteria:**
- [ ] `biscuit/src/hashing/xx_hash.rs` deleted
- [ ] `pub mod xx_hash;` removed from `hashing/mod.rs`
- [ ] `pub use xx_hash::{...}` removed from `hashing/mod.rs`
- [ ] `HashVariant` enum removed from `hashing/mod.rs`
- [ ] `xxhash-rust` dependency removed from `biscuit/Cargo.toml`
- [ ] blake3 and argon2id modules preserved
- [ ] `cargo check -p shared` succeeds

---

### Phase 4: Update Documentation

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 3 |
| **Parallelizable** | Yes (with Phase 5) |

**Objective:** Update module documentation to reflect the new architecture.

**Deliverables:**
- Updated `biscuit/src/hashing/mod.rs` documentation

**Acceptance Criteria:**
- [ ] Module documentation updated to reference `biscuit_hash` for xxHash
- [ ] Examples show correct import paths
- [ ] `cargo doc -p shared` succeeds without warnings

---

### Phase 5: Run Tests and Validate

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust, nextest |
| **Suggested Skills** | - |
| **Complexity** | Low |
| **Dependencies** | Phase 3 |
| **Parallelizable** | Yes (with Phase 4) |

**Objective:** Validate the migration with compilation checks and test suite execution.

**Deliverables:**
- Test report for shared package
- Test report for biscuit-hash package
- Clippy lint check

**Acceptance Criteria:**
- [ ] `cargo test -p shared` passes all tests
- [ ] `cargo test -p biscuit-hash` passes all tests
- [ ] `cargo clippy -p shared` produces no new warnings
- [ ] `cargo build --workspace` succeeds

---

## Dependency Graph

```
Phase 1 ──► Phase 2 ──► Phase 3 ──┬──► Phase 4
                                  └──► Phase 5
```

Phases 4 and 5 can run in parallel after Phase 3 completes.

## Lessons Learned

> Capture discoveries about skills or memory resources (CLAUDE.md, README.md, etc.) that were inaccurate, incomplete, or missing.

- [FILE: biscuit/src/mermaid/mod.rs]: Contains xxHash usage at lines 160-164 that was initially missing from planning scope
- [MODULE: hashing/mod.rs]: HashVariant enum is duplicated in shared and biscuit-hash; removal required to avoid type conflicts
- [NAMING: biscuit vs shared]: Directory is `biscuit/` but package name is `shared` - use package name in cargo commands

## Package Changes in Execution

> Dependencies to be added, updated, or removed during implementation.

- [ADD]: biscuit-hash to shared - provides xx_hash functionality via workspace path reference
- [REMOVE]: xxhash-rust from shared - no longer needed after migration to biscuit-hash

