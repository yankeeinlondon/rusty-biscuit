---
status: "done"
started_at: 17:41:55
finished_at: 17:46
duration: ~5 minutes
tts_gender: male
requirements: |
  ## Refined Requirements (after clarification)

  1. **Symbol Metadata Enhancement**:
     - Functions/methods: parameters with names and types, return types
     - All symbols: doc comments (Rust ///, Python docstrings, JSDoc /** */)
     - Target: All 16 supported languages

  2. **CLI Output Improvements**:
     - `--json` flag: Complete JSON output (already exists, enhance completeness)
     - Default terminal: Colors via owo-colors, OSC8 hyperlinks for file paths
     - `--plain` flag: No escape codes (new flag)

  3. **Testing**:
     - Use rust-testing skill
     - Comprehensive test coverage for symbol extraction
     - Language fixtures for all supported languages
required_skills:
  - rust
  - tree-sitter
  - clap
  - rust-testing
  - serde
  - thiserror
important_skills:
  cli: "For terminal escape codes and OSC8 links"
  escape-codes: "For implementing hyperlinks and ANSI colors"
  colored-text: "For NO_COLOR compliance and TTY detection"
subagents:
  Plan: "Create phased implementation plan"
  Explore: "Module assessment for monorepo impact"
  feature-tester-rust: "Comprehensive test coverage"
  general-purpose: "Reviews (completeness, concurrency, correctness)"
monorepo_modules_impacted:
  - tree-hugger-lib (direct)
  - tree-hugger-cli (direct)
  - test_export (transitive - depends on tree-hugger-lib)
completeness_changes: []
concurrency_changes: []
detail_changes: []
lessons_learned_count: 0
---
# Planning Process

- [x] Prep Started [17:41:55]
    - [x] Identified Skills [17:42]
    - [x] Identified Subagents [17:42]
- [x] Prep complete with 35% context available [17:42]
- [x] Clarification (orchestrator) [17:43]
    - [x] User asked clarifying questions (human in the loop) [17:43]
    - [x] Requirements updated: all languages, doc comments only, owo-colors [17:43]
- [x] Planning Subagent [agent: **Plan**] started [17:44]
    - [x] subagent skills used: rust, tree-sitter, clap, rust-testing, serde, thiserror, cli, escape-codes, owo-colors
    - [x] Planning completed [17:44]
- [x] Module Assessment Subagent [agent: **Explore**] started [17:44]
    - [x] subagent skills used: rust
    - [x] Module Assessment completed [17:44]
- [x] All Pre-review Steps are complete [17:44]
    - 35% of context window still available
- [x] Review Started [17:44]
   - [x] Completeness Review [agent: **general-purpose**]
       - [x] subagent skills used: rust, tree-sitter, clap, rust-testing, serde
   - [x] Concurrency Review [agent: **general-purpose**]
       - [x] subagent skills used: rust
   - [x] Correctness Review [agent: **general-purpose**]
        - [x] subagent skills used: tree-sitter, rust, serde
- [x] Reviews Completed [17:45]
    - 35% of context window still available
- [x] Plan Finalization [agent: **general-purpose**] started [17:46]
    - [x] subagent skills used: rust, tree-sitter, clap, serde, owo-colors, cli, rust-testing
- [x] Plan finalized [17:46]
    - 35% of context window still available
- Final Steps
    - [x] Lessons learned collected from all subagents
    - [x] Researching 2 packages (owo-colors, percent-encoding)
- [x] Summarized plan to user via STDOUT
    - Project File: 2026-01-20.plan-for-tree-hugger-symbol-metadata.md
    - Started: 17:41:55
    - Completed: 17:46
    - Duration: ~5 minutes



## Plan

### Phase 1: Enhanced SymbolInfo Data Model

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, serde |
| **Suggested Skills** | rust-testing (validation) |
| **Complexity** | Low |
| **Dependencies** | None |
| **Parallelizable** | Yes (with Phase 5) |

**Objective:** Extend data model with ParameterInfo, FunctionSignature, doc_comment field.

**Deliverables:**
- `ParameterInfo` struct: name, type_annotation, default_value, is_variadic
- `FunctionSignature` struct: parameters, return_type
- Extended `SymbolInfo` with doc_comment and signature fields
- Use `#[serde(skip_serializing_if)]` for backward compatibility

**Acceptance Criteria:**
- [ ] New structs defined in `lib/src/shared/symbol.rs`
- [ ] Backward-compatible JSON serialization
- [ ] `cargo test -p tree-hugger-lib` passes

---

### Phase 2: Query File Enhancements (Tier 1 - 5 Languages)

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | tree-sitter, rust |
| **Complexity** | Medium |
| **Dependencies** | Phase 1 |
| **Parallelizable** | No |

**Objective:** Add query captures for Rust, TypeScript, JavaScript, Python, Go.

**Deliverables:**
- `@definition.function` capture for full function nodes
- `@definition.doc` capture for doc comments (using `.` anchoring)
- Language-specific patterns per capability matrix

**Acceptance Criteria:**
- [ ] All 5 query files updated
- [ ] `tree-sitter query` validates without errors
- [ ] Existing captures still work

---

### Phase 3: Query Processing Updates

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, tree-sitter |
| **Complexity** | High |
| **Dependencies** | Phase 1, Phase 2 |
| **Parallelizable** | No |

**Objective:** Update TreeFile to extract signatures and doc comments.

**Deliverables:**
- `extract_signature()` function
- `extract_parameters()` function
- `extract_doc_comment()` function
- `clean_doc_comment()` helper

**Acceptance Criteria:**
- [ ] Parameters with types extracted for Tier 1 languages
- [ ] Doc comments cleaned of prefixes (///, *, etc.)
- [ ] Unit tests for extraction functions

---

### Phase 4: Query File Enhancements (Tier 2 - 11 Languages)

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | tree-sitter |
| **Complexity** | Medium |
| **Dependencies** | Phase 2 |
| **Parallelizable** | Yes (with Phase 5) |

**Objective:** Extend queries to remaining 11 languages.

**Languages:** Java, PHP, Perl, Bash, Zsh, C, C++, C#, Swift, Scala, Lua

**Acceptance Criteria:**
- [ ] All 11 query files updated
- [ ] Bash/Zsh/Perl limitations documented
- [ ] Queries validate without errors

---

### Phase 5: CLI Output Enhancement

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | clap, cli, owo-colors |
| **Complexity** | Medium |
| **Dependencies** | None |
| **Parallelizable** | Yes (with Phases 1-4) |

**Objective:** Add colors, OSC8 hyperlinks, --plain flag.

**Deliverables:**
- Add `owo-colors` and `percent-encoding` dependencies
- `--plain` flag implementation
- Color scheme (Function=green, Type=magenta, etc.)
- OSC8 file:// hyperlinks with percent-encoding
- NO_COLOR/TTY detection

**Acceptance Criteria:**
- [ ] `--plain` disables all escape codes
- [ ] `--json` always uncolored
- [ ] Hyperlinks work in iTerm2/VS Code/Kitty

---

### Phase 6: Enhanced Test Fixtures

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust-testing |
| **Complexity** | Low |
| **Dependencies** | Phase 3, Phase 4 |
| **Parallelizable** | Yes |

**Objective:** Enhance fixtures with doc comments and typed parameters.

**Acceptance Criteria:**
- [ ] All 16 fixtures have documented functions
- [ ] Python has docstring example
- [ ] Variadic examples where supported

---

### Phase 7: CLI Integration Tests

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust-testing, cli |
| **Complexity** | Medium |
| **Dependencies** | Phase 5, Phase 6 |
| **Parallelizable** | No |

**Objective:** Test --plain flag, JSON structure, colored output.

**Acceptance Criteria:**
- [ ] Test --plain suppresses ANSI codes
- [ ] Test --json has no escape codes
- [ ] Test signature/doc_comment in JSON output
- [ ] `cargo test -p tree-hugger-cli` passes


## Lessons Learned

> Capture discoveries about skills or memory resources (CLAUDE.md, README.md, etc.) that were inaccurate, incomplete, or missing.

- [SKILL: tree-sitter]: Anchoring with `.` for adjacent sibling matching is well-documented
- [SKILL: owo-colors]: `supports-colors` feature required for NO_COLOR/TTY detection
- [CODEBASE: fixtures]: Current fixtures are minimal - enhanced fixtures needed for metadata testing
- [CODEBASE: CLAUDE.md]: tree-hugger package not documented in monorepo structure section


## Package Changes in Execution

> Dependencies to be added, updated, or removed during implementation.

- [ADD]: `owo-colors` (4.2) to tree-hugger-cli - Terminal coloring with NO_COLOR support
    - "What are the correct feature flags for owo-colors 4.x to enable conditional color support?"
- [ADD]: `percent-encoding` (2.3) to tree-hugger-cli - URL encoding for OSC8 file:// links

