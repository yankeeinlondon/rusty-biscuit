---
status: "done"
started_at: "14:46:54"
finished_at: "14:59:01"
duration: "12 minutes"
tts_gender: male
requirements: |
  In the schematic package, when generating an API (and its request/response schemas), the generated
  documentation from `cargo doc` should be a clear and well-designed documentation page.

  REFINED REQUIREMENTS (after clarification):

  1. **Fix non-doc comments**: Comments like "This code was automatically generated by schematic-gen.
     Do not edit manually." should use `//` style comments (not `///` doc comments) so they appear
     in source code but not in rustdoc output.

  2. **Add introductory paragraph**: A clear description of the API defined in the module.

  3. **Add code example**: A basic API call example showing a simple request/response pattern.

  4. **Add API link**: The API's name should link to the official API provider's documentation
     (e.g., ElevenLabs docs, not the OpenAPI spec).

  5. **Add authentication note**: Brief note about how authentication works with the API.

  6. **Add feature list**: Bullet list of major API capabilities.
required_skills:
  - rust
  - prettyplease
  - syn
important_skills:
  serde: "if modifications affect serialization/deserialization of request/response types"
  reqwest: "if changes impact HTTP client generation patterns"
subagents:
  Plan: "create phased implementation plan"
  Explore: "module assessment for monorepo"
  general-purpose: "reviews and finalization"
  feature-tester-rust: "verify generated documentation"
monorepo_modules_impacted:
  - schematic/gen/src/output.rs (HIGH - main output assembly)
  - schematic/gen/src/codegen/api_struct.rs (HIGH - API struct docs)
  - schematic/gen/src/codegen/request_enum.rs (MEDIUM - request enum docs)
  - schematic/gen/src/codegen/mod.rs (LOW - module registration)
  - schematic/schema/src/*.rs (AUTO - regenerated output)
completeness_changes:
  - "HIGH: Replace 'general-purpose' subagent with 'general-purpose' (exists in Task tool)"
  - "MEDIUM: Add implementation detail for categorize_endpoints() method"
  - "MEDIUM: Specify which endpoint to use for example_section()"
  - "LOW: Add specific test cases for Phase 4 and 6"
concurrency_changes:
  - "HIGH: Phases 1 and 2 can run in parallel (different files)"
  - "MEDIUM: Split Phase 1 into sub-phases by file for parallel execution"
  - "MEDIUM: Add cargo check gate between Phase 3 and Phases 4/5"
detail_changes:
  - "ERROR: Missing categorize_endpoints() method implementation"
  - "ERROR: Missing imports (proc_macro2::TokenStream, quote::quote)"
  - "ERROR: Missing pub mod module_docs; in codegen/mod.rs"
  - "WARNING: Handle docs_url=None by omitting link entirely"
  - "WARNING: Show integration point in assemble_api_module()"
lessons_learned_count: 4
---
# Planning Process

- [x] Prep Started [14:46:54]
    - [x] Identified Skills [14:47:15] - rust, prettyplease, syn (required); serde, reqwest (suggested)
    - [x] Identified Subagents [14:47:15] - Plan, Explore, general-purpose, feature-tester-rust
- [x] Prep complete with context available [14:47:20]
- [x] Clarify (orchestrator) [14:47:20]
    - [x] User asked clarifying questions (human in the loop) [14:47:35]
    - [x] Requirements updated: basic API call example, official docs URL link, add auth note + feature list
- [x] Planning Subagent [agent: Plan] started [14:48:00]
    - [x] subagent skills used: rust, prettyplease, syn
    - [x] Planning completed [14:49:15]
- [x] Module Assessment Subagent [agent: Explore] started [14:48:00]
    - [x] subagent skills used: rust, syn
    - [x] Module Assessment completed [14:49:15]
- [x] All Pre-review Steps are complete [14:49:30]
- [x] Review Started [14:49:45]
   - [x] Completeness Review [agent: general-purpose]
       - [x] subagent skills used: rust, prettyplease, syn
   - [x] Concurrency Review [agent: general-purpose]
       - [x] subagent skills used: rust
   - [x] Correctness Review [agent: general-purpose]
       - [x] subagent skills used: rust, prettyplease, syn
- [x] Reviews Completed [14:51:00]
- [x] Plan Finalization [agent: general-purpose] started [14:51:30]
    - [x] subagent skills used: rust, prettyplease, syn
- [x] Plan finalized [14:52:15]
- Final Steps
    - [x] Lessons learned collected from all subagents (4 items)
    - [x] Package research: None required (all deps present)
- [x] Summarized plan to user via STDOUT [14:59:01]
    - Project File: `.ai/plans/2026-01-17.plan-for-improve-schematic-generated-docs.md`
    - Started: 14:46:54
    - Completed: 14:59:01
    - Duration: 12 minutes

## Plan

### Phase 1: Fix Non-Doc Comments

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, syn, prettyplease |
| **Suggested Skills** | None |
| **Complexity** | Low |
| **Dependencies** | None |
| **Parallelizable** | Yes (with Phase 2) |

**Objective:** Convert warning comments like "Do not edit manually" from doc comments (`#![doc = ...]`) to regular comments (`//`) so they appear in source but not in rustdoc.

**Deliverables:**
- Modified `assemble_api_module()` in `schematic/gen/src/output.rs`
- Modified `assemble_shared_module()` in same file
- Modified `assemble_lib_rs()` in same file
- Modified `assemble_prelude()` in same file

**Acceptance Criteria:**
- [ ] Generated files start with `// This code was automatically generated...` (regular comment)
- [ ] The notice does NOT appear in `cargo doc` output
- [ ] All existing tests pass

**Implementation Notes:**
- Remove `#![doc = #generated_notice]` from quote! macros
- Prepend regular comment in `format_code()` post-processing (prettyplease loses regular comments)

---

### Phase 2: Create Documentation Builder Struct

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, syn, prettyplease |
| **Suggested Skills** | serde (if adding serialization) |
| **Complexity** | Medium |
| **Dependencies** | None |
| **Parallelizable** | Yes (with Phase 1) |

**Objective:** Create `ModuleDocBuilder` struct to generate rich module-level documentation.

**Deliverables:**
- New file `schematic/gen/src/codegen/module_docs.rs`
- Modified `schematic/gen/src/codegen/mod.rs` with `pub mod module_docs;`

**Acceptance Criteria:**
- [ ] `ModuleDocBuilder::new(api: &RestApi)` constructor exists
- [ ] `build()` returns `TokenStream` with module-level doc attributes
- [ ] `categorize_endpoints()` groups endpoints by HTTP method
- [ ] `example_section()` uses first GET endpoint (or first endpoint if no GET)
- [ ] `docs_url` handling: include link when Some, omit entirely when None
- [ ] Required imports: `use proc_macro2::TokenStream;`, `use quote::quote;`

**Implementation Notes:**
```rust
fn categorize_endpoints(&self) -> BTreeMap<String, Vec<(String, String)>> {
    // Group by HTTP method (GET, POST, etc.)
}

fn intro_paragraph(&self) -> String {
    match &self.api.docs_url {
        Some(url) => format!(" Generated API client for [{}]({}).\n\n{}",
            self.api.name, url, self.api.description),
        None => format!(" Generated API client for {}.\n\n{}",
            self.api.name, self.api.description),
    }
}
```

---

### Phase 3: Integrate Documentation Builder

| Property | Value |
|----------|-------|
| **Subagent** | `general-purpose` |
| **Required Skills** | rust, syn, prettyplease |
| **Suggested Skills** | None |
| **Complexity** | Low |
| **Dependencies** | Phase 1, Phase 2 |
| **Parallelizable** | No |

**Objective:** Replace minimal module docs with rich documentation from `ModuleDocBuilder`.

**Deliverables:**
- Modified `assemble_api_module()` in `schematic/gen/src/output.rs`
- Updated imports: `use crate::codegen::module_docs::ModuleDocBuilder;`

**Acceptance Criteria:**
- [ ] `assemble_api_module()` uses `ModuleDocBuilder` for module documentation
- [ ] Generated module includes: intro, auth section, features list, code example
- [ ] `cargo check -p schematic-gen` succeeds

**Implementation Notes:**
```rust
pub fn assemble_api_module(api: &RestApi) -> TokenStream {
    let module_docs = ModuleDocBuilder::new(api).build();
    quote! {
        #module_docs
        use serde::{Deserialize, Serialize};
        // ... rest of module
    }
}
```

---

### Phase 3.5: Cargo Check Gate

| Property | Value |
|----------|-------|
| **Subagent** | None (orchestrator) |
| **Complexity** | Low |
| **Dependencies** | Phase 3 |

**Objective:** Verify integrated code compiles before proceeding.

**Command:** `cargo check -p schematic-gen && cargo clippy -p schematic-gen -- -D warnings`

---

### Phase 4: Update Test Infrastructure

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust |
| **Complexity** | Medium |
| **Dependencies** | Phase 3.5 |
| **Parallelizable** | Yes (with Phase 5) |

**Objective:** Create comprehensive unit tests for `ModuleDocBuilder`.

**Deliverables:**
- Unit tests in `schematic/gen/src/codegen/module_docs.rs`

**Acceptance Criteria:**
- [ ] Test: `builder_creates_valid_tokenstream`
- [ ] Test: `builder_includes_api_name`
- [ ] Test: `builder_categorizes_endpoints_by_method`
- [ ] Test: `builder_handles_empty_endpoints`
- [ ] Test: `builder_includes_docs_url_when_present`
- [ ] Test: `builder_omits_docs_url_when_none`
- [ ] Test: `builder_generates_example_with_first_get`

---

### Phase 5: Regenerate Schema Output

| Property | Value |
|----------|-------|
| **Subagent** | None (orchestrator) |
| **Required Skills** | rust |
| **Complexity** | Low |
| **Dependencies** | Phase 3.5 |
| **Parallelizable** | Yes (with Phase 4) |

**Objective:** Regenerate all schema files with new documentation.

**Command:** `just -f schematic/justfile generate`

**Deliverables:**
- Updated `schematic/schema/src/elevenlabs.rs`
- Updated `schematic/schema/src/lib.rs`, `shared.rs`, `prelude.rs`

---

### Phase 6: Verify Documentation Output

| Property | Value |
|----------|-------|
| **Subagent** | `feature-tester-rust` |
| **Required Skills** | rust |
| **Complexity** | Low |
| **Dependencies** | Phase 4, Phase 5 |
| **Parallelizable** | No |

**Objective:** Verify documentation renders correctly in rustdoc.

**Command:** `cargo doc --manifest-path schematic/schema/Cargo.toml --no-deps --open`

**Acceptance Criteria:**
- [ ] Module-level documentation visible in HTML
- [ ] Endpoint categories render as lists
- [ ] Example code appears with syntax highlighting
- [ ] Documentation links work (when docs_url present)
- [ ] "Do not edit manually" notice NOT visible in docs

---

## Execution Order

```
Phase 1 (Fix Comments) ─┬─> Phase 3 (Integrate) ─> Phase 3.5 (Check) ─┬─> Phase 4 (Tests) ─┬─> Phase 6 (Verify)
Phase 2 (Create Builder)┘                                             └─> Phase 5 (Regen) ─┘
```

## Lessons Learned

> Discoveries from subagents about skills or resources that were inaccurate, incomplete, or missing.

- [SKILL: prettyplease]: Comment preservation limitation - prettyplease is AST-based and loses non-doc comments; must use post-processing to add regular comments
- [SKILL: syn]: Feature flag requirement - `syn::parse2::<syn::File>` requires the `full` feature for parsing complete Rust files
- [CRATE: quote]: Regular comments (`//`) cannot be directly emitted by `quote!` macro - must use post-processing in format step
- [CODEBASE: schematic/define]: RestApi.docs_url is `Option<String>` - must handle None case gracefully (omit link, don't render `[Name](#)`)

## Package Changes in Execution

> Dependencies to be added, updated, or removed during implementation.

- None required - all dependencies (syn, quote, proc_macro2, prettyplease) already present in schematic-gen

