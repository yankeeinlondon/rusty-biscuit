[
  {
    "id": "REC_001",
    "title": "Split Phase 2-3: Schema Updates & Code Generation",
    "priority": "HIGH",
    "category": "phase_splitting",
    "description": "Separate header field definition from code generation",
    "rationale": "Phase 2 (adding header fields to RestApi/Endpoint structs) has no implicit dependency on code generator knowledge. Code generator can work independently on current struct versions while definition types are being extended.",
    "parallelization": "Enable 2-track development: Track A updates types, Track B prepares generator code in parallel. Merge before Phase 4.",
    "risk_level": "LOW",
    "dependencies": {
      "must_complete_first": ["Phase 1"],
      "can_overlap_with": ["Phase 2 and early Phase 3 (generator refactor)"]
    },
    "implementation_approach": [
      "Phase 2a: Add header field definitions to schematic-define types (5-10min)",
      "Phase 2b (parallel): Refactor schematic-gen codegen modules for header support (10-15min)",
      "Phase 3: Integrate headers into generators once types are stabilized (5-10min)"
    ]
  },
  {
    "id": "REC_002",
    "title": "Defer Directory Restructuring Until End",
    "priority": "MEDIUM",
    "category": "process_optimization",
    "description": "Move schematic/schematic/schema → schematic/schema after code generation is finalized",
    "rationale": "Current Phase 1 blocks all downstream work. However, directory restructuring is mechanical and does not affect code generation logic. By deferring to Phase 6 or post-Phase 5, you reduce coordination overhead during active development.",
    "parallelization": "Make Phase 1 conditional: Complete minimal path setup only, defer full restructuring. This is safe because both paths resolve to same location via import aliases.",
    "risk_level": "LOW",
    "dependencies": {
      "must_complete_first": [],
      "can_defer_until": ["End of implementation or post-Phase 5"]
    },
    "implementation_approach": [
      "Keep schematic/schematic/schema as-is for now",
      "Focus Phase 1 on structural validation (paths, references exist)",
      "After Phase 5 integration tests pass, execute full restructuring",
      "Update all workspace references (Cargo.toml) in single batch operation"
    ]
  },
  {
    "id": "REC_003",
    "title": "Concurrent Code Generator Module Updates",
    "priority": "HIGH",
    "category": "parallel_execution",
    "description": "Update schematic-gen codegen modules in parallel for each HTTP method",
    "rationale": "Code generator has modular structure: api_struct.rs, client.rs, error.rs, request_enum.rs, request_structs.rs. Header injection affects multiple files independently. Each module can be updated in parallel with minimal cross-module dependencies.",
    "parallelization": "Execute three independent tasks: (1) request_structs.rs (add header fields), (2) client.rs (inject header auth logic), (3) api_struct.rs (optional: expose header configuration)",
    "risk_level": "MEDIUM",
    "dependencies": {
      "must_complete_first": ["Phase 2 (type definitions)"],
      "can_overlap": ["request_structs.rs ↔ client.rs update (different concerns)"]
    },
    "implementation_approach": [
      "Task 1: Update request_structs.rs generator to include header fields from Endpoint",
      "Task 2: Update client.rs generator to apply headers during request building",
      "Task 3: Optionally extend api_struct.rs for header configuration methods",
      "Merge in sequence: (1) → (2) → (3), validate with e2e_generation.rs test after each merge"
    ]
  },
  {
    "id": "REC_004",
    "title": "Testing Strategy: Parallel Test Suite Execution",
    "priority": "MEDIUM",
    "category": "testing_optimization",
    "description": "Execute integration tests in parallel across different endpoint scenarios",
    "rationale": "Existing test files (e2e_generation.rs, http_client.rs, path_substitution.rs) can run concurrently. Test isolation is strong (tempfile-based output directories, wiremock for HTTP mocking).",
    "parallelization": "Use cargo's built-in parallel test runner: `cargo test --lib -- --test-threads=4` for Phase 5 validation",
    "risk_level": "LOW",
    "dependencies": {
      "must_complete_first": ["Phase 4"],
      "can_run_in_parallel": ["All existing test modules"]
    },
    "implementation_approach": [
      "Run unit tests in src/ sequentially (they're fast: <1s total)",
      "Run integration tests in tests/ with 4 concurrent threads",
      "Monitor for flaky tests via serial_test marker if environment-dependent",
      "Validate header propagation with new test case in e2e_generation.rs"
    ]
  },
  {
    "id": "REC_005",
    "title": "Race Condition Risk: Endpoint & RestApi Mutation",
    "priority": "CRITICAL",
    "category": "risk_mitigation",
    "description": "Synchronization required when both header fields are added to Endpoint & RestApi structs",
    "rationale": "Endpoint struct is defined in schematic-define/src/types.rs. RestApi struct is in same file. Code generators reference both. If fields added out-of-sync, code generation will fail with type errors.",
    "risk_mitigation": [
      "Add header field to RestApi struct first (parent type)",
      "Immediately add corresponding Endpoint header field",
      "Update code generators in single commit batch",
      "Run full test suite before Phase 3 begins"
    ],
    "risk_level": "CRITICAL",
    "dependencies": {
      "synchronization_point": "RestApi.headers + Endpoint.headers must both be present before Phase 3 begins"
    },
    "implementation_approach": [
      "Phase 2 is NOT parallelizable internally",
      "Create single commit: 'feat(schematic): add header fields to RestApi and Endpoint'",
      "Include tests for both struct fields in same commit",
      "Validate with: cargo test -p schematic-define"
    ]
  },
  {
    "id": "REC_006",
    "title": "Dependency Chain Validation",
    "priority": "HIGH",
    "category": "build_verification",
    "description": "Verify no circular dependencies between schematic-define and schematic-gen during concurrent changes",
    "rationale": "schematic-gen depends on schematic-define (Cargo.toml line 19: path = \"../define\"). Adding fields to define types should not require changes in define itself, but code generation logic must be compatible.",
    "verification_steps": [
      "After Phase 2: cargo build -p schematic-define",
      "After Phase 3 (early): cargo build -p schematic-gen",
      "Run: cargo metadata --format-version 1 to verify dependency tree",
      "Confirm zero circular dependencies before Phase 4"
    ],
    "risk_level": "LOW",
    "implementation_approach": [
      "Define types (Phase 2) with no codegen logic",
      "Codegen logic updates (Phase 3) consume new types, don't define them",
      "Validate build after each phase boundary"
    ]
  },
  {
    "id": "REC_007",
    "title": "Workspace-Level Parallelization via `just` Commands",
    "priority": "MEDIUM",
    "category": "build_orchestration",
    "description": "Leverage justfile parallelism for concurrent builds during validation phases",
    "rationale": "schematic/justfile exists with build, test, lint targets. Multiple developers can run tests independently across different modules.",
    "parallelization": "In Phase 5 testing, run: `just -f schematic/justfile test &` in parallel with linting: `just -f schematic/justfile lint` in separate shell",
    "risk_level": "LOW",
    "implementation_approach": [
      "Keep individual developer workflows sequential (one person = one task)",
      "Enable team-level parallelism: split Phase 5 validation across team members",
      "Person A: Run e2e_generation tests",
      "Person B: Run http_client tests",
      "Person C: Run clippy linting",
      "Merge results after both pass"
    ]
  },
  {
    "id": "REC_008",
    "title": "Conditional Feature Flags for Header Support",
    "priority": "MEDIUM",
    "category": "build_optimization",
    "description": "Consider feature flag for header functionality in generated code to avoid breaking changes",
    "rationale": "If header injection changes generated code structure, existing consumers may break. Feature flags allow opt-in adoption.",
    "implementation": "Add optional feature 'headers' to schematic-schema Cargo.toml, controlled via generator flag",
    "risk_level": "MEDIUM",
    "dependencies": {
      "optional_enhancement": "Implement in Phase 3 or Phase 4 if breaking changes are detected"
    }
  },
  {
    "id": "REC_009",
    "title": "Atomic Commit Strategy to Preserve Build Integrity",
    "priority": "HIGH",
    "category": "version_control",
    "description": "Batch related changes into single commits to maintain bisectability and rollback safety",
    "rationale": "Multi-phase changes risk leaving repository in broken state between commits. Atomic commits enable safe rollback.",
    "commits_recommended": [
      "Commit 1: 'feat(schematic/define): add header fields to RestApi and Endpoint'",
      "Commit 2: 'feat(schematic/gen): update codegen for header propagation' (includes request_structs, client, api_struct)",
      "Commit 3: 'feat(schematic/schema): regenerate with header support'",
      "Commit 4: 'test(schematic): add integration tests for header propagation'"
    ],
    "risk_level": "LOW"
  },
  {
    "id": "REC_010",
    "title": "Workspace Coordination Bottleneck",
    "priority": "MEDIUM",
    "category": "process_bottleneck",
    "description": "Root Cargo.toml workspace membership check is trivial but represents coordination point",
    "rationale": "schematic/define and schematic/gen are listed in root Cargo.toml members array (lines 3). This doesn't create true dependency but requires single point update.",
    "bottleneck_mitigation": "This is NOT a true blocker. Changes to define types don't require workspace changes. Defer workspace validation to final verification (Phase 6).",
    "risk_level": "LOW"
  }
]
